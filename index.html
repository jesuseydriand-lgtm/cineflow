<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mi Magis TV Universal</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      background: #000;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 10px;
    }
    h1 {
      text-align: center;
      font-size: 1.8em;
    }
    #player {
      width: 100%;
      height: 60vh;
      background: #111;
    }
    .category {
      margin-top: 20px;
    }
    .channel {
      padding: 12px;
      background: #222;
      margin: 5px 0;
      border-radius: 5px;
      cursor: pointer;
    }
    .channel:hover {
      background: #333;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>
  <h1>üì∫ Mi Magis TV Universal</h1>
  <div id="player">
    <video id="video" controls playsinline></video>
  </div>
  <div id="canales"></div>

  <script>
    const JSON_URL = "https://magis-tv-universal.onrender.com/canales.json";

    async function cargarCanales() {
      const cont = document.getElementById('canales');
      try {
        const res = await fetch(JSON_URL);
        const data = await res.json();
        for (const cat in data) {
          if (data[cat].length === 0) continue;
          const div = document.createElement('div');
          div.className = 'category';
          div.innerHTML = `<h2>${cat.replace(/_/g, ' ').toUpperCase()}</h2>`;
          data[cat].forEach(item => {
            const ch = document.createElement('div');
            ch.className = 'channel';
            ch.textContent = item.nombre;
            ch.onclick = () => reproducir(item.url);
            div.appendChild(ch);
          });
          cont.appendChild(div);
        }
      } catch (e) {
        cont.innerHTML = `<p style="color:red;text-align:center;">‚ùå Error</p>`;
      }
    }

    function reproducir(url) {
      const player = document.getElementById('player');
      if (url.includes('youtube.com') || url.includes('youtu.be')) {
        const id = url.split('v=')[1]?.split('&')[0] || url.split('/').pop();
        player.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1" allow="autoplay"></iframe>`;
      } else {
        player.innerHTML = '<video id="video" controls playsinline></video>';
        const v = document.getElementById('video');
        if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(url);
          hls.attachMedia(v);
          hls.on(Hls.Events.MANIFEST_PARSED, () => v.play());
        } else if (v.canPlayType('application/vnd.apple.mpegurl')) {
          v.src = url;
          v.play();
        }
      }
    }

    cargarCanales();
  </script>
</body>
</html>